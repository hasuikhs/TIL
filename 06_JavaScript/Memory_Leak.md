# Memory Leak

## 1. Memory Leak?

- Memory Leak(메모리 누수)는 **메모리 풀에서 반환되지 않으면서 애플리케이션에서 더 이상 쓰지 않는 메모리**로 정의 가능
- 각 프로그래밍 언어는 메모리 관리를 각각 다른 방법으로 처리하므로 메모리 누수 발생 가능성을 감소시킴

### 1.1 In JavaScript

- JavaScript에서는 GC(Garbage Collector)를 사용하여 메모리 관리하는데 도움을 줌
  - 메모리 영역이 **프로그램에서 여전히 참조 가능한지를 주기적으로 확인(도달 가능성, reachability)**하여 메모리 관리
  - 이같은 GC 언어는 메모리 관리 문제를 '프로그램에서 여전히 참조 가능한가?'에 관심이 있음
- GC언어의 메모리 누수의 주된 원인은 **원치 않는 참조(unwanted references)**

#### 1.1.1 Reference-counting GC

- 어떠한 오브젝트도 참조하지 않는 오브젝트, 즉 특정 오브젝트를 참조하는 다른 오브젝트가 하나도 없을때 GC 실행

```javascript
var x = {
    a: {
        b: 2
    }
};

var y = x;		// 'y' 변수는 위 오브젝트를 참조하는 두 번째 변수

x = 1;			// 'y' 변수가 위의 오브젝트를 참조하는 유일한 변수가 됨

var z = y.a;	// 'y.a'는 두 개의 참조를 가짐('y'가 속성으로 참조, 'z'가 변수로 참조)

y = 'mozilla';	// 'y' 변수가 참조했던 오브젝트가 없어졌지만, 'a' 속성이 'z' 변수에 참조되므로 메모리 해제 안됨

z = null;		// 이제 'x' 변수가 참조했던 오브젝트를 참조하는 다른 변수가 없으므로 GC 수행
```

- **한계: 순환 참조**

  - 두 객체가 서로 참조하는 속성으로 생성되어 순환 구조를 생성하는 함수가 있음
  - 함수 호출이 완료되면 두 객체는 스코프를 벗어나게 되어, 두 객체는 불필요해지므로 GC 실행되어야 함
  - 하지만 두 객체가 서로를 참조하고 있으므로, GC 대상이되지 않아 메모리 누수의 원인이 됨

  ```javascript
  function f() {
    var x = {};
    var y = {};
    x.a = y;         // x는 y를 참조한다.
    y.a = x;         // y는 x를 참조한다.
  
    return "azerty";
  }
  
  f();
  ```

  - 이 문제를 해결하기 위해 Mark-and-sweep 알고리즘을 같이 사용

#### 1.1.2  Mark-and-sweep 알고리즘