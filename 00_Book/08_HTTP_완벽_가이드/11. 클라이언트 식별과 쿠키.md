# 11. 클라이언트 식별과 쿠키

## 11.1 개별 접촉

- HTTP는 익명으로 사용하며 상태가 없고 요청과 응답으로 통신하는 프로토콜
- 현대의 웹 사이트들은 개인화된 서비스를 제공하고 싶어함
  - **개별 인사**
  - **사용자 맞춤 추천**
  - **저장된 사용자 정보**
  - **세션 추적**

## 11.2 HTTP 헤더

| 헤더 이름       | 헤더 타입  | 설명                                     |
| --------------- | ---------- | ---------------------------------------- |
| From            | 요청       | 사용자의 이메일 주소                     |
| User-Agent      | 요청       | 사용자의 브라우저                        |
| Referer         | 요청       | 사용자가 현재 링크를 타고 온 근원 페이지 |
| Authorization   | 요청       | 사용자 이름과 비밀번호                   |
| Client-ip       | 확장(요청) | 클라이언트의 IP 주소                     |
| X-Forwarded-For | 확장(요청) | 클라이언트의 IP 주소                     |
| Cookie          | 확장(요청) | 서버가 생성한 ID 라벨                    |

## 11.3 클라이언트 IP 주소

- 클라이언트의 IP 주소는 보통 HTTP 헤더에 없지만 웹 서버는 HTTP 요청을 보내ㅅ는 반대쪽 TCP 커넥션의 IP 주소를 알아냄
- **클라이언트 IP 주소로 사용자를 식별하는 방식은 다음의 약점을 가짐**
  - 클라이언트 IP는 사용자가 아닌, 사용하는 컴퓨터를 가리킴, 여러 사용자가 같은 컴퓨터를 사용하면 식별 불가
  - 인터넷 서비스 제공자는 사용자가 로그인하면 동적으로 IP 주소를 할당, 웹 서버는 사용자를 IP 주소로 식별 불가
  - 보안을 강화하기 위해 만흔 사용자가 네트워크 주소 변환(NAT) 사용
    - NAT 장비들은 클라이언트의 실제 IP 주소를 방화벽 뒤로 숨김
    - 클라이언트의 실제 IP 주소를 내부에서 사용하는 하나의 방화벽 IP 주소(다른 포트 번호)로 변환
  - HTTP 프락시와 게이트웨이는 원 서버에 새로운 TCP 연결
    - 웹 서버는 클라이언트의 IP 주소 대신 프락시 서버의 IP 주소를 봄
- 클라이언트 IP 주소를 사용하는 것은 큰 의미가 없음

## 11.4 사용자 로그인

- 웹 서버는 사용자 이름과 비밀번호로 인증할 것을 요구해서 사용자에게 명시적으로 식별 요청 가능
- 서버에서, 사용자가 사이트에 접근하기 전에 로그인 시키고자 한다면 `HTTP 401 Login Required` 응답코드를 브라우저로 보냄
- 다음 요청부터 `Authorization` 헤더에 그 정보를 기술하여 보냄

## 11.5 뚱뚱한 URL

- 사용자의 상태 정보를 포함하고 있는 URL을 뚱뚱한 URL이라 함
- 웹 서버와 통신하는 독립적인 HTTP 트랜젝션을 하나의 '세션' 혹은 '방문'으로 묶는 용도로 뚱뚱한 URL 사용 가능
- 뚱뚱한 URL은 사이트를 브라우징하는 사용자를 식별하는데 사용 가능
- 여러 가지 문제
  - **못생긴 URL**
  - **공유 불가능한 URL**
    - 특정 사용자의 세션에 대한 상태 정보를 포함하여, 누군가에게 보내게 되면 개인 정보를 공유할 가능성 존재
  - **캐시 사용 불가능**
    - URL로 만드는 것은, URL이 달라지기 때문에 기존 캐시에 불가능한 것을 의미
  - **서버 부하 가중**
    - 서버는 뚱뚱한 URL에 해당하는 HTML 페이지를 다시 그려야 함
  - **이탈**
    - 사용자가 링크를 타고 다른 사이트로 이동하거나 특정 URL을 요청해서 의도치 않게 세션에서 이탈하기 쉬움
    - 사용자가 이탈하면, 지금까지의 진척상황들(장바구니)이 초기화 될 수 있음
  - **세션 간 지속성 부재**
    - 사용자가 특정 URL을 북마킹하지 않는 이상, 로그아웃하면 모든 정보를 잃음