# 7. 캐시

> - 웹 캐시는 자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP 장치

## 7.1 불필요한 데이터 전송

- 복수의 클라이언트가 자주 쓰이는 원 서버 페이지에 접근할 때, 서버는 같은 문서를 클라이언트에 각각 한 번씩 전송
- 이 때 같은 바이트들이 네트워크를 계속 반복해서 이동하면 값비싼 네트워크 대역폭을 잡아먹어 부하를 줌
- **캐시를 이용하면, 서버 응답은 캐시에 보관되어, 중복해서 트래픽을 주고받는 낭비가 줄어듬**

## 7.2 대역폭 병목

- 캐시는 네트워크 병목을 줄여줌
- 네트워크는 원 격서버보다 로컬 네트워크 클라이언트에 더 넓은 대역폭 제공
- 클라이언트들이 서버에 접근할 때의 속도는, 그 경로에 있는 가장 느린 네트워크 속도와 같음

## 7.3 갑작스런 요청 쇄도(Flash Crowds)

- 갑작스런 사건으로 인해 트래픽이 급증하는 경우는 네트워크와 웹 서버의 심각한 장애를 야기

## 7.4 거리로 인한 지연

- 대역폭뿐아니라 거리로 인해 문제가 될 수 있음
- 모든 네트워크 라우터는 제각각 인터넷 트래픽을 지연
- CDN의 등장? **CDN은 캐싱을 수행하지만, 캐싱은 CDN이 아님**

## 7.5 적중과 부적중

- 캐시 적중
  - 캐시에 요청이 도착했을 때, 만약 그에 대응하는 사본이 있다면 그를 이용해 요청을 처리
- 캐시 부적중
  - 만약 대응하는 사본이 없다면 그냥 원서버로 전달

### 7.5.1 재검사

- 원 서버 콘텐츠는 변경 가능하기에, 캐시는 반드시 그들이 갖고 있는 사본이 여전히 최신인지를 때때로 점검
- 캐시는 스스로 원한다면 언제든지 사본 재검사 가능, 단 충분히 오래된 경우에만 재검사를 함
- 콘텐츠가 변경되지 않았다면, 서버는 아주 작은 304 Not Modified 응답을 보냄
- 사본의 유효함을 알게 된 캐시는 즉각 사본이 최신이라고 임시로 다시 표시한 후 사본을 클라이언트에 제공

### 7.5.2 적중률

- 캐시가 요청을 처리하는 비율
- 적중률은 예측하기 어렵지만 오늘날 적중률 40%면 웹 캐시로 괜찮음

### 7.5.3 바이트 적중률

- 문서들이 모두 같은 크기인 것은 아니기에 문서 적중률이 모든 것을 말해주지는 않음
- 몇몇 큰 객체는 덜 접근되지만 그 크기 때문에 전체 트래픽에는 더 크게 기여하기 때문에 사용

### 7.5.4 적중과 부적중의 구별

- HTTP는 클라이언트에게 응답이 캐시 적중이었는지 아니면 원 서버 접근인지 말해줄 수 있는 방법을 제공하지 않음
- 응답이 캐시에서 왔는지 알아내는 한 가지 방법은 Date 헤더를 이용
  - 응답의 Date 헤더 값을 현재 시각과 비교하여 응답의 생성일이 더 오래 되었다면 응답이 캐시된 것을 확인 가능
- 또 다른 방법은 응답이 얼마나 오래되었는지 말해주는 Age 헤더를 이용

