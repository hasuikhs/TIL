# 18. 웹 호스팅

- 콘텐츠 리소스를 저장, 중개, 관리하는 일을 통틀어 웹 호스팅이라 함

## 18.1 호스팅 서비스

- 초기에는 각 회사가 하드웨어를 구매하여 자체 망을 구축하여 웹 서버 소프트웨어를 관리
- 웹이 빠르게 대중화되면서, 전문적으로 관리하는 호스팅 서비스를 제공하는 업체 등장
  - 물리적인 장비 관리에서부터 고객이 직접 콘텐츠를 제공 가능한 총체적인 웹 호스팅까지 다양한 서비스 존재

## 18.2 가상 호스팅

- 많은 웹 호스팅 업자는 컴퓨터 한 대를 여러 고객이 공유하게 해서 저렴한 웹 호스팅 서비스 제공, 이를 가상 호스팅이라 부름

- 각 웹 사이트는 다른 서버에서 호스팅하는 것처럼 보이지만, 물리적으로 같은 서버에서 호스팅
- 가상 호스팅은 비용, 공간, 관리에 이점이 있으므로, 가상 호스팅을 제공하는 업체는 한 서버에 수많은 웹 사이트를 호스팅하려 함

### 18.2.1 호스트 정보가 없는 가상 서버 요청

- HTTP/1.0 명세는 공용 웹 서버가 호스팅하고 있는 가상 웹 사이트에 누가 접근하고 있는지 식별 기능 제공하지 않음
- 웹 서버는 사용자가 어떤 웹 사이트로 접근하려고 하는지 아는데 필요한 정보가 불충분
- 두 요청이 서로 다른 웹 사이트에 완전히 다른 문서를 요청을 하더라도, 요청 자체는 똑같이 생김
- HTTP 대리 서버와 인터셉트 프락시 또한 어떤 사이트를 요청하는지에 관한 정보 필요

### 18.2.2 가상 호스팅 동작하게 하기

- 호스트 정보를 HTTP 요청 명세에 넣지 않은 것은, 각 웹 서버가 정확히 한 웹 사이트만 호스팅할 것이라고 예상한 실수
- 초기 명세는 가상 호스팅을 고려하지 않았기 때문에, 웹 호스팅 업자는 공용 가상 호스팅을 지원하는 데 필요한 컨벤션 개발
  - 모든 HTTP 요청 메시지에 경로 컴포넌트 뿐 아니라 완전한 URI도 포함하여 해결
  - HTTP/1.1을 지원하는 서버는 HTTP 요청 메시지에 있는 전체 URI 처리 가능해야 함
  - 하지만 기존의 모든 애플리케이션이 이 명세에 맞게 업그레이드하기까지는 오랜 시간이 걸릴 것이지만 그 중 네가지 기술 등장
    - URL 경로를 통한 가상 호스팅
    - 포트번호를 통한 가상 호스팅
    - IP 주소를 통한 가상 호스팅
    - Host 헤더를 통한 가상 호스팅

### 18.2.3 HTTP/1.1 Host 헤더

- Host 헤더는 RFC 2068에 정의되어 있는 HTTP/1.1 요청 헤더
- 가상 서버는 매우 흔하기 때문에 대부분의 HTTP 클라이언트가 HTTP/1.1과 호환되지 않더라도, Host 헤더는 구현

## 18.3 안정적인 웹 사이트 만들기

- 웹 사이트에 장애가 생기는 상황
  - 서버 다운
  - 트래픽 폭증
  - 네트워크 장애나 손실

### 18.3.1 미러링 된 서버 팜

- 서버 팜은 서로 대신 가능하고 식별 가능하게 설정된 웹 서버들의 집합
- 서버 팜의 서버에 있는 콘텐츠들은 한 곳에 문제가 생기면 다른 한 곳에서 대신 전달 가능하게 미러링 가능함
- 보통, 미러링된 서버는 계층적인 관계에 있음
  - 마스터 원 서버: '콘텐츠 원본 제작자'  같이 행동하는 서버
  - 복제 원 서버: 마스터 원 서버로부터 콘텐츠를 받은 미러링 된 서버
- 서버 팜에 배포하는 간단한 방법 하나는, 네트워크 스위치를 사용해서 서버에 분산 요청을 보냄
- 서버에 호스팅 되고 있는 각 웹 사이트의 IP 주소는 스위치의 IP 주소가 됨

### 18.3.2 콘텐츠 분산 네트워크

- CDN은 특정 콘텐츠의 분산을 목적으로 하는 단순한 네트워크
- 네트워크의 노드는 서버, 대리 서버, 혹은 프락시 서버가 될 수 있음

### 18.3.3 CDN의 대리 캐시

- 대리 캐시는 복제 원 서버를 대신해 사용 가능
- 리버스 프락시라고도 불리는 대리 서버는 미러링된 웹 서버처럼 콘텐츠에 대한 요청을 받음
- 대리 서버와 미러링 된 서버의 차이점은, 대리 서버의 보통 수요에 따라서 동작함
  - 대리 서버는 원 서버의 전체 콘텐츠를 복사하지 않고, 요청된 콘텐츠만 저장함

### 18.3.4 CDN의 프락시 캐시

- 대리 서버와는 다르게, 전통적인 프락시 캐시는 어떤 웹 서버 요청이든지 다 받을 수 있음
- 요청이 있을 때만 저장하는 프락시 캐시는 조금 다른 방식으로 동작하는데, 레이어2 혹은 레이어3 장비(스위치 혹은 라우터)가 중간에서 웹 트래픽을 처리하기도 함
- 가로채기 설정은, 클라이언트와 서버 사이의 모든 HTTP 요청이 물리적으로 캐시를 거치게 네트워크 설정 가능한지에 따라 달라짐
- 콘텐츠는 받는 요청에 따라서 캐시에 분산

