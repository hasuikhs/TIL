# 20. 리다이렉션과 부하 균형

- 리다이렉션 보통 메시지가 프락시, 캐시, 서버 팜의 특정 웹 서버 중 어디에서 끝나는지 판별하기 위해 사용
- 리다이렉션은 클라이언트의 메시지를 명시적으로 요청하지 않은 곳으로 전송 가능

## 20.1 왜 리다이렉트인가?

- 리다이렉션은 다음의 HTTP 애플리케이션의 요구 세가지의 이유로 현대의 웹에서는 불가피함
  - 신뢰 가능한 HTTP 트렌젹션의 수행
  - 지연 최소화
  - 네트워크 대역폭 절약
- 이러한 이유로 웹 콘텐츠는 흔히 여러 장소에 배포
  - 한 곳에서 실패한 경우 다른 곳을 이용 가능하므로 신뢰성 개선 가능
  - 클라이언트가 보다 가까운 리소스에 접근 가능하여 콘텐츠를 더 빨리 받게 되므로 응답시간 감소
  - 서버가 분산되므로 네트워크 혼잡 감소
- 리다이렉션이란 최적의 분산된 콘텐츠를 찾는 것을 도와주는 기법의 집합이라 생각 가능
- 리다이렉션 구현에는 부하 균형의 과제가 포함
  - 들어오는 메시지의 부하를 서버들의 집합에게 분산 가능
  - 반대의 경우도 어떤 방식의 부하 균형이든 리다이렉션을 포함

## 20.2 리다이렉트 할 곳

- 서버, 프락시, 캐시, 게이트웨이가 모두 공통적으로 서버의 특성을 갖고있기에 많은 리다이렉션은 모두에서 동작
- 그러나 특정 종류의 종단만을 위해 특별히 설계되어 일반적인 적용이 불가능한 리다이렉션 존재
- 웹 서버는 IP별로 요청을 다룸
  - 복제된 서버들로 요청을 분산한다는 것은 같은 URL에 대해 여러 곳에서 온 요청들을 각각 최적의 웹 서버로 전송한단 의미
- 프락시는 프로토콜별로 요청을 다룸
  - 이상적으로, 프락시 이웃의 모든 HTTP 트래픽은 프락시를 거쳐야 함
  - 캐시는 자주 찾는 문서를 저장하여 클라이언트에게 제공하기 때문에 리소스가 많이 드는 통신 회피 가능
  - 프락시로의 리다이렉트는 주 진입로의 트래픽을 근처에 있는 지름길로 빨아들이는 것과 같음

## 20.3 리다이렉션 프로토콜의 개요

- 리다이렉션의 목표는 HTTP 메시지를 가용한 웹 서버로 가급적 빨리 보내는 것
- 브라우저 설정, DNS, TCP/IP 라우팅, 그리고 HTTP는 모두 메시지를 리다이렉트하는 메커니즘을 제공
- DNS 리다이렉션을 비롯한 대부분의 기법들이 트래픽을 보내려는 곳이 어떤 서버냐에 상관없이 사용 가능한것에 반해 브라우저 설정과 같은 방법은 프락시로 향하는 리다이렉트 트래픽에 대해서만 사용 가능하다는 점에 주의

## 20.4 일반적인 리다이렉션 방법

### 20.4.1 HTTP 리다이렉션

- 몇몇 웹 사이트는 HTTP 리다이렉션을 이용해 간단하게 부하를 분산함
- 요청을 처리하는 서버는 가용한 것들 중 부하가 가장 적은 콘텐츠 서버를 찾아서 브라우저의 요청을 그 서버로 리다이렉트
- 웹 서버들이 광범위하게 분산되어 있다면 '최선의' 가용한 서버를 결정하는 것은 더욱 어려워짐
- 다른 리다이렉션에 비해 HTTP 리다이렉션이 갖는 장점 중 하나는 리다이렉트를 하는 서버가 클라이언트의 IP 주소를 안다는 것
- HTTP 리다이렉션은 서버로 향하는 요청의 방향을 변경 가능하지만, 몇 가지 단점이 있음
  - 어떤 서버로 리다이렉트할지 결정하려면 많은 처리를 해야하는데, 때로는 페이지 자체를 제공할 때와 같은 양의 처리가 필요
  - 페이지에 접근할 때마다 두 번의 왕복이 필요하기에 사용자가 더 오래 기다리게 함
  - 만양 리다이렉트 서버가 고장 나면, 사이트도 고장남
- 이러한 약점 때문에, HTTP 리다이렉션은 보통 몇몇 다른 리다이렉션 기법과 함께 조합하여 사용

### 20.4.2 DNS 리다이렉션

- DNS는 하나의 도메인에 여러 아이피 주소가 결부되는 것을 허용하며, DNS 분석자는 여러 IP 주소를 반환하도록 설정 가능
- **DNS 라운드 로빈**
  - DNS 라운드 로빈은 가장 ㅅ흔한 동시에 가장 단순한 리다이렉션 기법
  - 웹 서버 팜 전체에 대한 부하의 균형을 유지하기 위해 DNS 호스트 명 분석 기능을 사용
  - 순수한 부하 균형 전략이며, 서버에 대한 클라이언트의 상대적 위치나 서버의 현재 스트레스를 고려하지 않음
- **다중 주소와 라운드 로빈 주소 순환**
  - 대부분의 DNS 클라이언트는 그냥 다중 주소 집합의 첫 번째 주소 사용
  - 부하 균형을 위해, 대부분의 DNS 서버는 룩업이 끝났을 때마다 주소 순환, 이른 DNS 라운드 로빈이라 함
- **부하 균형을 위한 DNS 라운드 로빈**
  - 대부분의 DNS 클라이언트는 그냥 첫 번째 주소를 사용하기에, DNS 순환은 서버들 간의 부하 균형을 유지
  - 만약 DNS가 주소를 순환시키지 않으면, 대부분의 클라이언트가 목록의 첫 번째 서버를 선택하여 부하의 균형이 깨짐
- **DNS 캐싱의 효과**
  - 서버에 대한 각 DNS 룩업은 서버 주소를 가져오면서 부하를 순환시킴
  - 그러나, 이 부하 균형은 완벽하지 않음
    - DNS 룩업의 결과는 애플리케이션, 운영체제, 몇몇 자식 DNS 서버에 의해 기억되어 재사용 가능하기 때문
    - 호스트 하나에 대해 한 번의 DNS 룩업을 수행한 뒤, 그 주소를 몇 번이고 재사용

