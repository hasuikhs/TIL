# 6. 프락시

> - 웹 프락시 서버는 중개자
> - **클라이언트와 서버 사이에 위치하여 HTTP 메시지를 정리하는 중개인**

## 6.1 웹 중개자

### 6.1.1 개인 프락시와 공유 프락시

- **공용 프락시**
  - 대부분의 프락시는 공용이며 공유된 프락시
  - 중앙 집중형 프락시를 관리하는 게 비용 효율이 높고 쉬움
  - **여러 사용자들의 공통된 요청에서 이득**을 취할 수 있음
- **개인 프락시**
  - 브라우저의 기능 확장이나 성능 개선 또는 무료 ISP 서비스를 위한 광고 운영 위함

### 6.1.2 프락시 대 게이트웨이

- 프락시
  - 같은 프로토콜을 사용하는 둘 이상의 애플리케이션을 연결
- 게이트웨이
  - 서로 다른 프로토콜을 사용하는 둘 이상을 연결
  - **다른 프로토콜을 전송하더라도 서로 간의 트랜젝션 완료할 수 있도록 프로토콜 변환기처럼 동작**
- **실질적으로 프락시와 게이트웨이의 차이점은 모호**
  - 브라우저와 서버는 다른 버전의 HTTP를 구현하기에, 프락시는 때때로 프로토콜을 변환

## 6.2 프락시 사용 이유

- 프락시 서버는 보안 개선, 성능 향상, 비용 절감에 이득
- 프락시 서버는 모든 HTTP 트래픽을 건드릴 수 있기에, 부가적인 가치를 주는 여러 유용한 웹 서비스 구현을 위해 트래픽을 감시하고 수정 가능

## 6.3 프락시 위치

### 6.3.1 프락시 서버 배치

- **출구 프락시**
  - 로컬 과 인터넷 사이를 오가는 트래픽을 제어하기 위해 프락시를 로컬 네트워크 출구에 위치
  - 방화벽 제공, 인터넷 요금 절약, 인터넷 트래픽 성능 개선을 위해 사용
- **입구 프락시**
  - 고객의 모든 요청을 종합적으로 처리하기 위해 프락시는 ISP 접근 지점에 위치
  - 다운로드 속도 개선, 인터넷 대역폭 비용 절감을 위해 캐시 프락시를 사용해 사본 저장
- **대리 프락시**
  - 네트워크의 가장 끝에 있는 웹 서버들의 바로 앞에 위치하여 모든 요청 처리
  - 필요할 때만 웹 서버에게 자원 요청 가능
  - 보안 기능 추가, 빠른 웹 서버 캐시를 느린 웹 서버의 앞에 놓음으로써 성능 개선 가능
  - 대리 프락시는 일반적으로 웹 서버의 이름과 IP 주소로 스스로 가장하기에 모든 요청은은 프락시로 감
- **네트워크 교환 프락시**
  - 캐시를 이용해 인터넷 혼잡을 완화하고 트래픽 흐름 감시

### 6.3.2 프락시 계층

- 여러개의 프락시들은 프락시 계층이라 불리는 연쇄 구성 가능
- **프락시 계층 콘텐츠 라우팅**
  - 프락시는 여러 이유에 의해 메시지를 다양하고 유동적인 프락시 서버와 원 서버들의 집합에 전송 가능

### 6.3.3 프락시의 트래픽 처리 방법

- 클라이언트 수정
- 네트워크 수정
- DNS 이름공간 수정
- 웹 서버 수정

## 6.4 클라이언트 프락시 설정

- 수동 설정
- 브라우저 기본 설정
- 프락시 자동 설정(Proxy auto-configuration, PAC)
  - Javascript는 프락시 자동 설정 파일에 대한 URI 제공 가능
- WPAD 프락시 발견
  - 대부분의 브라우저는 자동설정 파일을 다운받을 수 있는 '설정 서버'를 자동으로 찾아줌

## 6.5 프락시 요청의 미묘한 특징

- **프락시 URI는 서버 URI와 다름**
  - 클라이언트가 프락시 대신 서버로 요청을 보내면 요청의 URI가 달라짐
  - 원래 HTTP 설계에서 클라이언트는 단일 서버와 통신했었기에, 부분 URI만 보냄
    - 부분 URI : 호스트명과 포트번호가 없는 URI
  - 하지만 프락시가 떠오르면서 서버의 이름을 알 필요가 생김
- **가상 호스팅에서 일어나는 같은 문제** : 위와 같음
- **인터셉트 프락시는 부분 URI를 받음**

  - 몇몇 프락시는 클라이언트에게는 보이지 않을 수 있음
  - 프락시를 사용한다고 설정되어 있지 않더라도, 대리 프락시나 인터셉트 프락시를 지날 수 있음
    - 대리 프락시: 원 서버의 호스트 명과 IP 주소를 사용해 원 서버를 대신하는 프락시 서버
    - 인터셉트 프락시: 클라이언트에서 서버로 가는 트래픽을 가로채 캐시된 응답을 돌려줌
- **프락시는 프락시 요청과 서버 요청을 모두 다룰 수 있음**
  -   트래픽이 프락시 서버로 리다이렉트 되는 여러 가지 방법이 존재
  -   다목적 프락시 서버는 요청 메시지의 완전한 URI와 부분 URI 모두 지원해야 함
- **전송 중 URI 변경**
- **URI 클라이언트 자동확장과 호스트 명 분석**
  - 브라우저는 프락시의 존재 여부에 따라 요청 URI를 다르게 분석
- **프락시 없는 URI 분석**
  - 브라우저는 유효한 호스트 명이 발견될 때까지 다양한 호스트 명의 가능성들을 검색
- **명시적인 프락시를 사용할 때의 URI 분석**
- **인터셉트 프락시를 이용한 URI 분석**

## 6.6 메시지 추적

### 6.6.1 Via 헤더

- Via 헤더 필드는 메시지가 지나는 각 중간 노드의 정보를 나열
- 메시지가 노드를 지날 때마다, 중간 노드는 Via 목록의 끝에 반드시 추가되어야 함
- 요청을 보내고 응답을 돌려주는 과정에 관여하는 모든 메시지 발송자들의 프로토콜을 다루는 능력을 알아보기 위해 사용
- Via 문법
  - 프로토콜 이름
  - 프로토콜 버전
  - 노드 이름
  - 노드 코멘트

### 6.6.2 TRACE 메서드

- 요청 메시지를 프락시의 연쇄를 따라가면서 **어떤 프락시를 지나가고 어떻게 요청 메시지를 수정하는지 관찰/추적**할 수 있도록 해줌
- **TRACE는 프락시 흐름을 디버깅하는데 매우 유용**
- TRACE 요청이 목적지 서버에 도착지 서버에 도착했을 때, 서버는 전체 요청 메시지를 HTTP 응답 메시지 본문에 포함시켜 송신

## 6.7 프락시 인증

- 프락시는 접근 제어 장치로서 제공될 수 있음
- 유효한 접근 권한 자격을 프락시에 제출하지 않는 한 콘텐츠에 대한 요청을 차단하는 프락시 인증 메커니즘 정의
- 프락시 인증은 인증에 참여하는 프락시가 연쇄상에 여러 개 있을 때는 잘 동작하지 않음

