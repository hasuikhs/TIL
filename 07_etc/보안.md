# 보안

## 1. XSS(Cross Site Scripting)

### 1.1 XSS ?

- 게시판이나 웹 메일 등에 자바 스크립트와 같은 스크립트 코드를 삽입해 개발자가 고려하지 않은 기능이 작동하게 하는 치명적인 공격
- 클라이언트(사용자)를 대상으로 한 공격이다.

### 1.2 종류

#### 1.2.1 Reflected XSS

![image-20200219225857328](C:\Users\STU\AppData\Roaming\Typora\typora-user-images\image-20200219225857328.png)

- 공격자가 미리 XSS 공격에 취약한 웹 사이트를 탐색하고, XSS 공격을 위한 스크립트를 포함한 URL을 사용자에게 노출시킴
- 사용자가 해당 URL을 클릭할 경우, 취약한 웹 사이트의 서버에 스크립트가 포함된 URL을 통해 Request를 전송하고, 웹 서버에서는 해당 스크립트를 포함한 Response를 전송하게 된다.

#### 1.2.2 Stored XSS

![image-20200219225936399](C:\Users\STU\AppData\Roaming\Typora\typora-user-images\image-20200219225936399.png)

- 웹 사이트의 게시판에 스크립트를 삽입하는 공격 방식
- 공격자는 게시판에 스크립트를 삽입한 후 공격 대상자가 해당 게시글을 클릭하도록 유도
- 공격자가 미리 XSS 공격에 취약한 웹 사이트를 탐색하고 XSS 공격을 위한 스크립트를 포함한 게시글을 웹 사이트에 업로드
- 게시글의 URL을 사용자에게 노출하고 사용자가 게시글을 확인함으로써 URL에 대한 요청을 서버에 전송
- 웹 서버에서 스크립트를 포함한 Response를 전송하며 공격이 수행

#### 1.2.3 DOM Based XSS

![image-20200219230840595](C:\Users\STU\AppData\Roaming\Typora\typora-user-images\image-20200219230840595.png)

- 사용자의 브라우저가 HTML 페이지를 구문 분석할때마다 공격 스크립트가 DOM 생성의 일부로 실행되면서 공격
- 페이지 자체는 변하지 않으나, 페이지에 포함되어 있는 브라우저측 코드가 DOM 환경에서 악성코드로 실행
- 서버와 관계없이 브라우저에서 발생

### 1.3 위험성

#### 1.3.1 쿠키 정보 및 세션 ID 획득

- 공격자는 페이지 및 게시판에 공격을 수행함으로써 해당 페이지를 이용하는 사용자의 쿠키 정보나 세션 ID를 획득 가능
- 만약 세션 ID 등을 쿠키에 포함하는 경우, XSS 공격을 통해서 사용자의 세션 ID를 획득해 공격자가 불법적으로 정상 사용자인 척 가장 가능

#### 1.3.2 시스템 관리자 권한 획득

- 웹 서버에 다양한 악성 데이터를 포함시킨 후, 사용자의 브라우저가 악성 데이터를 실행 가능
- 공격자는 아직 패치되지 않은 취약점에 대한 공격 코드가 실행되도록 해 사용자의 시스템을 통제 가능

#### 1.3.3 악성코드 다운로드

- XSS 공격은 악성 스크립트 자체로 악성 프로그램을 다운로드는 불가능
- 하지만, 사용자가 악성 스크립트가 있는 URL을 클릭하도록 유도해 악성 프로그램을  받을  수 있는 사이트로 Redirect하거나 트로이 목마 프로그램을 다운로드 유도 가능

#### 1.3.4 거짓 페이지 노출

- 공격에 취약한페이지일 경우, `<script>`태그 뿐 아니라 `<img>`와 같은 그림을 표시하는 태그를 사용해 원래 페이지와는 전혀 관련이 없는 페이지 표시 가능
- 기타 다른 태그도 사용이 가능할 경우, 원래 페이지의 일부를 변조해 거짓 페이지가 노출 가능해 이를 통해 개인정보 유출 등의 위험이 존재

### 1.4 XSS 방지법

- XSS 공격은 IPS, IDS, 방화벽 등으로도 방지가 불가능
- 때문에 단순히 문자를 필터링하는 등의 방법만이 존재

#### 1.4.1 Script 문자 필터링

- XSS 공격은 입력값에 대한 검증이 제대로 이루어지지 않아 발생하는 취약점이기 때문에 사용자의 모든 입력값에 대하여 서버측에서 필터링을 해주어야 함
- PHP에서는 eregi함수를 이용하면 XSS 공격에 주로 사용되는 문자들을 필터링 가능

#### 1.4.2 htmlentities 사용

- PHP에서는 htmlentities라는 함수가 있음
- htmlentities는 모든 특수문자를 HTML 엔티티로 변환함