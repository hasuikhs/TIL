# 3. 네트워크 통신

## 3.1 유니캐스트, 멀티캐스트, 브로드캐스트, 애니캐스트

- 네트워크에서 출발지에서 목적지로 데이터를 전송할 때 사용하는 통신 방식

  - **유니캐스트**
    - 1 : 1 통신
    - 출발지와 목적지가 1 :1 통신
    - 실제로 사용하는 대부분의 통신 방식
  - **브로드캐스트**
    - 1 : 모든 통신
    - 동일 네트워크에 존재하는 모든 호스트가 목적지
    - 유니캐스트로 통신하기 전, 주로 상대방의 정확한 위치를 알기 위해 사용
    - 기본 동작은 네트워크 내에서 모든 호스트에 패킷을 전달할 때 사용
  - **멀티캐스트**
    - 1 : 그룹(멀티캐스트 구독 호스트) 통신
    - 하나의 출발지에서 다수의 특정 목적지로 데이터 전송
    - 멀티캐스트 그룹 주소를 이용해 해당 그룹에 속한 다수의 호스트로 패킷을 전송하기 위한 통신 방식
    - 단방향으로 다수에게 동시에 같은 내용을 전달해야할 때 사용(IPTV, 사내 방송 등)
  - **애니캐스트**
    - 1 : 1  통신(목적지는 동일 그룹 내의 1개 호스트)
    - 다수의 동일 그룹 중 가장 가까운 호스트에서 응답
    - IPv4에서는 일부 기능 구현, IPv6은 모두 구현 가능
    - 애니캐스트 주소가 같은 호스트들 중에서 가장 가깝거나 가장 효율적으로 서비스 가능한 호스트 통신 방식

  | 타입         | 통신 대상 | 범위                  | IPv4 | IPv6 | 예제       |
  | ------------ | --------- | --------------------- | ---- | ---- | ---------- |
  | 유니캐스트   | 1 : 1     | 전체 네트워크         | O    | O    | HTTP       |
  | 브로드캐스트 | 1 : 모두  | 서브넷(로컬 네트워크) | O    | X    | ARP        |
  | 멀티캐스트   | 1 : 그룹  | 정의된 구간           | O    | O    | 방송       |
  | 애니캐스트   | 1 : 1     | 전체 네트워크         | △    | O    | 6 to 4 DNS |

  - **통신 방식을 구분할 때 중요한 점은 출발지가 기준이 아닌 목적지 주소를 기준으로 구분**

## 3.2 MAC 주소

- Media Access Control의 줄임말로 2계층(데이터 링크)에서 토신을 위해 네트워크 인터페이스에 할당된 고유 식별자

### 3.2.1 MAC 주소 체계

- MAC 주소는 변경 불가능하게 하드웨어에 고정되어 출하되므로 네트워크 구성 요소마다 다른 주소를 가짐
- MAC 주소는 48비트의 16진수 12자리로 표현
  - 앞의 24비트와 뒤의 24비트로 나누어 구분
    - OUI
      - 앞의 24비트인 '제조사 코드'
      - IEEE가 제조사에 할당하는 부분
    - UAA
      - 뒤의 24비트
      - 각 제조사에서 네트워크 구성 요소에 할당하는 부분
- **네트워크 카드나 장비를 생산할 때 하드웨어적으로 정해져 나오므로 MAC 주소를 BIA(Burend-In Address)라고도 부름**

### 3.2.2 MAC 주소 동작

- NIC는 자신의 MAC 주소를 가지고 있고 전기 신호가 들어오면 2계층에서 패킷으로 변환하여 내용을 구분한 후 도착지 MAC 주소 확인
- 만약 도착지 MAC 주소가 자신이 갖고 있는 MAC 주소와 다르면 그 패킷을 폐기
- 패킷의 목적지 주소가 자기 자신이거나 브로드캐스트, 멀티캐스트와 같은 그룹 주소이면 처리해야할 주소로 인지해 패킷 정보를 상위 계층으로 넘김

## 3.3 IP 주소

- IP 주소를 포함한 다른 프로토콜 스택의 3계층 주소의 특성
  - 사용자가 변경 가능한 논리 주소
  - 주소에 레벨이 있음, 그룹을 의미하는 네트워크 주소와 호스트 주소로 나뉨

### 3.3.1 IP 주소 체계

- IP는 v4, v6 두 체계가 사용되며 IPv4 주소는 32비트, IPv6 주소는 128비트
- IPv4 주소를 표기할 때는 4개의 옥텟(Octet)이라고 부르는 8비트 단위로 나누고 각 옥텟은 `.`으로 구분
- 2계층의 MAC 주소가 16진수로 표기된 것과 달리 IP 주소는 10진수로 표기하므로 0 ~ 255의 값 사용 가능
- IP 주소는 **네트워크 주소**와 **호스트 주소** 두 부분으로 나뉨
  - 네트워크 주소
    - 호스트들을 모은 네트워크를 지칭하는 주소
    - 네트워크 주소가 동일한 네트워크를 로컬 네트워크라 함
  - 호스트 주소
    - 하나의 네트워크 내에 존재하는 호스트를 구분하기 위한 주소
- IP주소의 네트워크 주소와 호스트 주소는 구분하는 경계점이 고정되어 있지 않음
- 필요한 호스트 IP 개수에 따라 네트워크의 크기를 다르게 할당 가능한 클래스(Class) 개념 도입
  - A 클래스
    - 첫 번째 옥텟에 구분자를 가지며, 약 1600만 개의 IP 주소를 가질 수 있음
    - 주소 범위: 1~127.0.0.0 
  - B 클래스
    - 두 번째 옥텟에 구분자를 가지며, 약 6만 5천 개의 IP 주소를 가질 수 있음
    - 주소 범위: 128~191.0.0.0
  - C 클래스
    - 세 번째 옥텟에 구분자를 가지며, 약 250 개의 IP 주소를 가질 수 있음
    - 주소 범위: 192~223.0.0.0
  - 이 구분자는 서브넷 마스크라고 함

### 3.3.2 클래스풀과 클래스리스

- 클래스(Class) 기반의 IP 주소 체계를 클래스풀(Classful)이라고 함
- IP 주소 체계를 처음 만들었을 때는 클래스 개념을 도입한 것이 확장성 있고 주소 낭비가 적은 최적의 조건을 만들 수 있었음

#### 3.3.2.1 클래스리스 네트워크의 등장

- 인터넷이 상용화되면서 인터넷에 연결되는 호스트 숫자가 폭발적으로 증가하면서 IP 주소가 부족해짐
- IP 주소 부족과 낭비 문제를 해결하기 위한 3가지 보존, 전환 전략 등장
  - 클래스리스, CIDR(Classless Inter-Domain Routing) 기반 주소 체계
  - NAT와 사설 IP 주소
  - IPv6
- IPv4의 가장 큰 문제는 주소 자체의 부족도 있지만 상위 클래스(A Class)를 할당받은 조직에서 제대로 사용하지 못하면서 낭비하는 것
- 클래스풀에서는 한 개의 클래스 네트워크가 한 조직에 할당되면 아무리 비어 있는 주소라도 IP를 분할해 다른 기관이 사용 불가능
- 이 문제를 해결하기 위해 클래스 개념 자체를 버리는 클래스리스 등장
- 현재 우리가 사용하는 주소 체계는 클래스 개념을 적용하지 않는 클래스리스 기반 주소 체계
- 클래스리스 네트워크에서는 별도로 네트워크와 호스트 주소를 나누는 구분자를 사용하는데 이를 서브넷 마스크라고 함

### 3.3.3 서브네팅

- 원래 부여된 클래스의 기준을 무시하고 새로운 네트워크-호스트 구분 기준을 사용자가 정해 원래 클래스풀 단위의 네트워크보다 더 쪼개 사용하는 것을 서브네팅이라 함
- 옥텟 단위로 구분되는 서브네팅은 이해와 운영이 쉽지만 실제로는 옥텟 단위보다 더 잘게 네트워크를 쪼개 2진수의 1비트 단위로 네트워크를 분할하므로 서브네팅을 이해하기 어려움
- 실무에서 서브네팅에 대해 고민해야하는  두 가지 경우
  - 네트워크 사용자 입장
    - 네트워크에서 사용 가능한 IP 범위 파악
    - 기본 게이트웨이와 서브넷 마스크 설정이 제대로  되어 있는지 확인
  - 네트워크 설계자 입장
    - 네트워크 설계 시 네트워크 내에 필요한 단말을 고려한 네트워크 범위 설계

#### 3.3.3.1 네트워크 사용자의 서브네팅

- 네트워크 사용자는 이미 설계되어 있는 네트워크에서 사용 가능한 IP 주소 범위를 파악해야 함
  - 주어진 네트워크 범위 밖의 IP를 할당하거나 서브넷 마스크를 잘못 입력할 경우
    - 로컬 네트워크의 특정 범위에 속해있는 단말과 통신에 문제
    - 외부 네트워크 전체에 통신하지 못하는 상황 발생
  - 기존 클래스 단위처럼 옥텟 단위의 네트워크를 사용할 경우
    - 모든 수가 10진수 단위로 표현되므로 관리자나 사용자가 이해하기 쉬움
    - 대부분의 서브네팅은 비트 단위로 분할되므로 이런 환경에 속해 있을 경우, 어떤 IP 범위가 내가 속한 네트워크이고 어떤 IP 범위가 원격지 네트워크 인지 판단하기 어려움

#### 3.3.3.2 네트워크 설계자 입장

- 네트워크를 새로 구축하는 경우
  - 사용자와 반대로 설계자는 네트워크의 크기를 고려해 서브넷 마스크를 결정, 설계, 반영
  - 네트워크 설계자가 IP를 설계할 때 고민해야 할 부분
    - 서브넷된 하나의 네트워크에 IP를 몇 개나 할당해야 하나?
    - 서브넷된 네트워크가 몇 개나 필요하나?
- 네트워크를 설계할 때 가능하면 사설 IP 대역을 사용해 충분한 IP 대역을 사용하는 것이 좋음
  - 공인 IP는 인터넷에서 유일하게 사용되므로 IP 수가 제한되어 있고 할당받은 IP를 사용하지 않는 경우, IP 할당기관이 회수함
  - 하지만 사설 IP는 회사 내부에서만 사용하므로 제한 없이 큰 네트워크 사용 가능
- 공인 IP를 사용해 여유 없이 네트워크를 할당하면 크기가 다른 네트워크가 많아짐\
  - 이렇게 되면 네트워크 관리자 입장에서도 관리가 힘들어지고, 일반 사용자도 IP를 쉽게 구분하거나 알아볼 수 없게 됨
  - 그러므로 최대한 같은 크기의 네트워크를 할당하고 10진수로 표현해도 쉽게 이해 가능한 C클래스 단위인 24비트로 쪼개 할당
- 네트워크를 단계적으로 잘 설계하면 관리하기 쉽고 네트워크 장비 성능도 향상 가능

### 3.3.4 공인 IP와 사설 IP

- 공인 IP

  - 인터넷에 접속하려면 필요
  - 전 세계에서 유일해야 하는 식별자

- 사설 IP

  - 인터넷 접속하지 않거나 NAT 기술을 사용할 경우
  - 개인적으로 네트워크 구축 가능
  - 인터넷에 직접 접속 불가능하지만 IP를 변환해주는 NAT 장비에서 공인 IP로 변경 후에 인터넷 접속 가능

  - 사설 네트워크를 구축할 때 NAT를 사용하여 인터넷에 연결하더라도 다른 사용자에게 할당된 IP를 사설 네트워크 사용 불가
    - 다른 인터넷 연결에는 문제가 없지만 내부 네트워크에 할당된 IP를 공식으로 사용하는 네트워크로 접속 불가능하므로 인터넷 어느 구간에서도 사용되는 않는 RFC에 몇시된 사설 IP 대역을 사용할 것을 추천
