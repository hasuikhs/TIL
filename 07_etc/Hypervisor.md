# Hypervisor

## 1. Hypervisor

- 하이퍼바이저는 **가상화**를 구현하기 위한 기반 기술
- 각 OS는 커널에서 자원관리와 명령 해석을 포함한 모든 것을 컨트롤하는데, 이 커널에서 사용하는 규칙이 OS마다 모두 다름
- 이를 **중재해주는 것이 바로 하이퍼바이저**

### 1.2 Type 1

- Native, 혹은 bare-metal이라고 부름
- **하이퍼바이저가 OS가 종속되지 않고, 하드웨어에 직접 설치되는 구조**
- 하이퍼바이저 자체에서 직접 하드웨어를 제어하기 때문에 상대적으로 오버헤드(어떤 처리를 하기 위해 들어가는 시간과 메모리)가 적어 리소스 관리 유연
- 하지만, **하드웨어를 제어할 OS가 없기 때문에 별도의 관리 기능 필요해서 DOM0라는 관리 머신이 같이 구동**
- **전가상화와 반가상화로 분류 가능**

#### 1.2.1 전가상화(Full-Virtualization)

- 전가상화는 하드웨어를 완전히 가상화하는 방식으로 Hardware Virtual Machine이라고 불림
- 하이퍼바이저를 구동하면 DOM0가 실행되며, **모든 가상머신들의 하드웨어 접근이 DOM0를 통해 이루어짐**
- 하이퍼바이저는 가상화된 OS가 무엇이든 OS의 명령어를 알 수 있음
- 장점
  - 하드웨어를 완전히 가상화하기 때문에 게스트 OS의 별다른 수정 불필요
- 단점
  - 하이퍼바이저가 모든 명령을 중재하기 때문에 성능이 비교적 느림

#### 1.2.2 반가상화(Paravirtualization)

- 반가상화는 전가상화와 달리 하드웨어를 완전히 가상화하지 않음
- 전가상화의 성능 저하의 문제를 해결하기 위해 Hyper Call 이라는 인터페이스를 통해 하이퍼바이저에게 직접 요청
- 즉, 가상화된 각 OS에서 내리는 각각의 명령어를 번역(각 OS에 따른 번역기가 따로 있다고 생각)
- 장점
  - 모든 명령을 DOM0를 통해 하이퍼바이저에게 요청하는 전가상화에 비해 빠름
- 단점
  - 하이퍼바이저에게 Hyper Call 요청을 가능하도록 각 OS의 커널을 수정해야하며, 오픈소스 OS가 아니면 반가상화를 이용하기 쉽지 않음

### 1.3 Type 2

- 일반적으로 사용하는 가상머신 (VM Ware, Virtual Box 등)
- 하드웨어에 OS를 먼저 설치하고, 그위에 하이퍼바이저를 설치
- 이때 하드웨어 설치된 OS를 호스트 OS인데, 이 OS가 하드웨어를 알아서 관리해주기에 **DOM0와 같은 관리 머신이 불필요**
- 하지만, 호스트 OS 위에서 하이퍼바이저가 구동되고, 다시 그 위에 가상머신을 띄우는 방식이기에 호버헤드가 큼
- 이 가상상 머신 위에서 구동되는 OS를 게스트 OS라 함
